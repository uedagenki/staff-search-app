<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ã‚¿ãƒƒãƒ•æ–°è¦ç™»éŒ² - STAFF SEARCH</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #2d2d2d 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .register-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .register-header {
            background: linear-gradient(135deg, #0a0a0a 0%, #2d2d2d 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .register-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .register-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .register-body {
            padding: 30px;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0a0a0a;
            box-shadow: 0 0 0 3px rgba(10, 10, 10, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .photo-upload {
            padding: 30px;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-upload:hover {
            border-color: #0a0a0a;
            background: rgba(10, 10, 10, 0.02);
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        .photo-upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .skip-button {
            background: transparent;
            color: #666;
            border: none;
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 10px;
        }

        .register-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #0a0a0a 0%, #2d2d2d 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .register-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(10, 10, 10, 0.3);
        }

        .login-link {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
        }

        .login-link a {
            color: #0a0a0a;
            text-decoration: none;
            font-weight: 600;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* æ¤œç´¢çµæœã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            margin-top: 5px;
        }

        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f5f5f5;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-name {
            font-weight: 600;
            color: #0a0a0a;
            margin-bottom: 4px;
        }

        .search-result-address {
            font-size: 12px;
            color: #666;
        }

        .search-loading {
            padding: 15px;
            text-align: center;
            color: #666;
        }

        .search-no-results {
            padding: 15px;
            text-align: center;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-header">
            <img src="staff_search_logo.png" alt="STAFF SEARCH Logo" style="width: 60px; height: 60px; margin-bottom: 12px;">
            <h1>ğŸ’¼ ã‚¹ã‚¿ãƒƒãƒ•æ–°è¦ç™»éŒ²</h1>
            <p style="color: white; margin-top: 10px; font-size: 14px;">ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã§ä»Šã™ãé–‹å§‹</p>
            <p>ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã¨ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
        </div>

        <div class="register-body">
            <form id="staffRegisterForm">
                <div class="form-group">
                    <label for="name">ãŠåå‰ <span style="color: red;">*</span></label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        placeholder="å±±ç”° å¤ªéƒ" 
                        required
                    >
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="storeName">åº—èˆ—å</label>
                        <div style="position: relative;">
                            <input 
                                type="text" 
                                id="storeName" 
                                name="storeName" 
                                placeholder="åº—èˆ—åã‚’æ¤œç´¢ã¾ãŸã¯å…¥åŠ›"
                                autocomplete="off"
                            >
                            <button 
                                type="button" 
                                id="storeSearchBtn"
                                style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;"
                                title="åº—èˆ—ã‚’æ¤œç´¢"
                            >
                                ğŸ” æ¤œç´¢
                            </button>
                        </div>
                        <div id="storeSearchResults" class="search-results" style="display: none;"></div>
                        <div style="margin-top: 5px;">
                            <label style="font-size: 12px; color: #666; cursor: pointer;">
                                <input type="checkbox" id="newStoreCheck" style="margin-right: 5px;">
                                æ–°è¦åº—èˆ—ã‚’ç™»éŒ²
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="companyName">ä¼šç¤¾å</label>
                        <div style="position: relative;">
                            <input 
                                type="text" 
                                id="companyName" 
                                name="companyName" 
                                placeholder="ä¼šç¤¾åã‚’æ¤œç´¢ã¾ãŸã¯å…¥åŠ›"
                                autocomplete="off"
                            >
                            <button 
                                type="button" 
                                id="companySearchBtn"
                                style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;"
                                title="ä¼šç¤¾ã‚’æ¤œç´¢"
                            >
                                ğŸ” æ¤œç´¢
                            </button>
                        </div>
                        <div id="companySearchResults" class="search-results" style="display: none;"></div>
                        <div style="margin-top: 5px;">
                            <label style="font-size: 12px; color: #666; cursor: pointer;">
                                <input type="checkbox" id="newCompanyCheck" style="margin-right: 5px;">
                                æ–°è¦ä¼šç¤¾ã‚’ç™»éŒ²
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="age">å¹´é½¢ <span style="color: red;">*</span></label>
                        <input 
                            type="number" 
                            id="age" 
                            name="age" 
                            placeholder="25" 
                            min="18"
                            max="100"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="gender">æ€§åˆ¥ <span style="color: red;">*</span></label>
                        <select id="gender" name="gender" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="male">ç”·æ€§</option>
                            <option value="female">å¥³æ€§</option>
                            <option value="other">ãã®ä»–</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="address">ä½æ‰€ <span style="color: red;">*</span></label>
                    <div style="display: flex; gap: 10px;">
                        <input 
                            type="text" 
                            id="address" 
                            name="address" 
                            placeholder="æ±äº¬éƒ½æ¸‹è°·åŒº" 
                            required
                            style="flex: 1;"
                        >
                        <button 
                            type="button" 
                            id="getLocationBtn"
                            style="padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; white-space: nowrap; font-size: 14px;"
                            title="ç¾åœ¨åœ°ã®ä½æ‰€ã‚’å–å¾—"
                        >
                            ğŸ“ ç¾åœ¨åœ°å–å¾—
                        </button>
                    </div>
                    <div id="locationStatus" style="font-size: 12px; margin-top: 5px; color: #666;"></div>
                </div>

                <div class="form-group">
                    <label for="jobTitle">è·ç¨® <span style="color: red;">*</span></label>
                    <select id="jobTitle" name="jobTitle" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="beautician">ç¾å®¹å¸«</option>
                        <option value="consultant">ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ</option>
                        <option value="trainer">ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼</option>
                        <option value="lawyer">å¼è­·å£«ãƒ»å£«æ¥­</option>
                        <option value="designer">ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼</option>
                        <option value="engineer">ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢</option>
                        <option value="teacher">è¬›å¸«ãƒ»æ•™å¸«</option>
                        <option value="medical">åŒ»ç™‚å¾“äº‹è€…</option>
                        <option value="other">ãã®ä»–</option>
                    </select>
                </div>

                <!-- ãã®ä»–ã®è·ç¨®å…¥åŠ›æ¬„ -->
                <div class="form-group" id="customJobTitleGroup" style="display: none;">
                    <label for="customJobTitle">è·ç¨®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ <span style="color: red;">*</span></label>
                    <input 
                        type="text" 
                        id="customJobTitle" 
                        name="customJobTitle" 
                        placeholder="ä¾‹: ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ã€ã‚³ãƒ¼ãƒã€ã‚»ãƒ©ãƒ”ã‚¹ãƒˆ" 
                        maxlength="15"
                    >
                    <p style="font-size: 12px; color: #666; margin-top: 4px;">15æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                </div>

                <div class="form-group">
                    <label>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ (æœ€å¤§5æš)</label>
                    <div id="photoGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-bottom: 10px;">
                        <!-- å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                    <div class="photo-upload" onclick="document.getElementById('photoUpload').click()" style="cursor: pointer;">
                        <input type="file" id="photoUpload" accept="image/*" multiple style="display: none;">
                        <div class="photo-upload-icon">ğŸ“·</div>
                        <p style="color: #666; font-size: 14px;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
                        <p style="color: #999; font-size: 12px; margin-top: 8px;">æ¨å¥¨: æ­£æ–¹å½¢ã€æœ€å° 400x400px<br>è¤‡æ•°é¸æŠå¯èƒ½ï¼ˆæœ€å¤§5æšï¼‰</p>
                    </div>
                    <button type="button" class="skip-button" onclick="skipPhoto()">å†™çœŸã¯å¾Œã§è¿½åŠ ã™ã‚‹</button>
                </div>

                <div class="form-group">
                    <label for="experience">çµŒé¨“å¹´æ•° <span style="color: red;">*</span></label>
                    <input 
                        type="number" 
                        id="experience" 
                        name="experience" 
                        placeholder="5" 
                        min="0"
                        max="50"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="bio">è‡ªå·±ç´¹ä»‹ <span style="color: red;">*</span></label>
                    <textarea 
                        id="bio" 
                        name="bio" 
                        placeholder="ã‚ãªãŸã®çµŒé¨“ã‚„ã‚¹ã‚­ãƒ«ã€å¼·ã¿ãªã©ã‚’è‡ªç”±ã«è¨˜å…¥ã—ã¦ãã ã•ã„..."
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span style="color: red;">*</span></label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        placeholder="example@email.com" 
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ <span style="color: red;">*</span></label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="8æ–‡å­—ä»¥ä¸Š" 
                        minlength="8"
                        required
                    >
                </div>

                <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»åˆ©ç”¨è¦ç´„ åŒæ„ -->
                <div class="form-group" style="margin-top: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input 
                            type="checkbox" 
                            id="agreeTerms" 
                            name="agreeTerms"
                            required
                            style="cursor: pointer; width: 18px; height: 18px; flex-shrink: 0;"
                        >
                        <label for="agreeTerms" style="font-size: 13px; line-height: 1.6; cursor: pointer; margin: 0;">
                            <a href="privacy_policy.html" target="_blank" style="color: #667eea; text-decoration: underline;">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
                            ãŠã‚ˆã³
                            <a href="terms_of_service.html" target="_blank" style="color: #667eea; text-decoration: underline;">åˆ©ç”¨è¦ç´„</a>
                            ã«åŒæ„ã—ã¾ã™ <span style="color: red;">*</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="register-button">ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã§ç™»éŒ²ã™ã‚‹</button>

                <div class="login-link">
                    ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ <a href="staff_login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        let photoSkipped = false;

        function skipPhoto() {
            photoSkipped = true;
            document.querySelector('.photo-upload').style.opacity = '0.5';
            document.querySelector('.skip-button').textContent = 'å†™çœŸã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ';
        }

        // è·ç¨®é¸æŠæ™‚ã®å‡¦ç†
        document.getElementById('jobTitle').addEventListener('change', function() {
            const customJobTitleGroup = document.getElementById('customJobTitleGroup');
            const customJobTitleInput = document.getElementById('customJobTitle');
            
            if (this.value === 'other') {
                customJobTitleGroup.style.display = 'block';
                customJobTitleInput.required = true;
            } else {
                customJobTitleGroup.style.display = 'none';
                customJobTitleInput.required = false;
                customJobTitleInput.value = '';
            }
        });

        // å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ï¼ˆæœ€å¤§5æšï¼‰
        let uploadedPhotos = [];
        
        document.getElementById('photoUpload').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            // æœ€å¤§5æšã¾ã§
            const remainingSlots = 5 - uploadedPhotos.length;
            const filesToAdd = files.slice(0, remainingSlots);
            
            if (filesToAdd.length === 0) {
                alert('æœ€å¤§5æšã¾ã§è¿½åŠ ã§ãã¾ã™');
                return;
            }
            
            filesToAdd.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedPhotos.push({
                        name: file.name,
                        data: event.target.result
                    });
                    renderPhotoGallery();
                };
                reader.readAsDataURL(file);
            });
            
            // å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
            e.target.value = '';
        });
        
        function renderPhotoGallery() {
            const gallery = document.getElementById('photoGallery');
            gallery.innerHTML = '';
            
            uploadedPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.style.cssText = 'position: relative; aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 2px solid #e0e0e0;';
                
                const img = document.createElement('img');
                img.src = photo.data;
                img.style.cssText = 'width: 100%; height: 100%; object-fit: cover;';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Ã—';
                deleteBtn.type = 'button';
                deleteBtn.style.cssText = 'position: absolute; top: 5px; right: 5px; width: 25px; height: 25px; border-radius: 50%; background: rgba(0,0,0,0.6); color: white; border: none; cursor: pointer; font-size: 18px; line-height: 1;';
                deleteBtn.onclick = function() {
                    uploadedPhotos.splice(index, 1);
                    renderPhotoGallery();
                };
                
                photoItem.appendChild(img);
                photoItem.appendChild(deleteBtn);
                gallery.appendChild(photoItem);
            });
            
            // å†™çœŸãŒè¿½åŠ ã•ã‚ŒãŸã‚‰ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            if (uploadedPhotos.length > 0) {
                document.querySelector('.skip-button').style.display = 'none';
                document.querySelector('.photo-upload p').textContent = `${uploadedPhotos.length}æšé¸æŠæ¸ˆã¿ï¼ˆæœ€å¤§5æšï¼‰`;
            } else {
                document.querySelector('.skip-button').style.display = 'block';
                document.querySelector('.photo-upload p').textContent = 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰';
            }
        }

        // ä½ç½®æƒ…å ±å–å¾—æ©Ÿèƒ½
        document.getElementById('getLocationBtn').addEventListener('click', async function() {
            const statusDiv = document.getElementById('locationStatus');
            const addressInput = document.getElementById('address');
            const btn = this;
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            btn.disabled = true;
            btn.textContent = 'å–å¾—ä¸­...';
            statusDiv.textContent = 'ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...';
            statusDiv.style.color = '#667eea';
            
            if (!navigator.geolocation) {
                statusDiv.textContent = 'ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“';
                statusDiv.style.color = 'red';
                btn.disabled = false;
                btn.textContent = 'ğŸ“ ç¾åœ¨åœ°å–å¾—';
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                async function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    try {
                        // Google Maps Geocoding APIã®ä»£æ›¿ã¨ã—ã¦ã€ã‚ˆã‚Šç¢ºå®ŸãªOSM Nominatim APIã‚’ä½¿ç”¨
                        // CORSå¯¾ç­–ã¨ã—ã¦refererãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=16&addressdetails=1&accept-language=ja`,
                            {
                                method: 'GET',
                                headers: {
                                    'User-Agent': 'StaffSearchApp/1.0',
                                    'Accept': 'application/json'
                                }
                            }
                        );
                        
                        if (!response.ok) {
                            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯åº§æ¨™æƒ…å ±ã®ã¿è¡¨ç¤º
                            addressInput.value = `ç·¯åº¦: ${lat.toFixed(6)}, çµŒåº¦: ${lon.toFixed(6)}`;
                            statusDiv.textContent = 'âš ï¸ ä½æ‰€å¤‰æ›å¤±æ•—ã€‚æ‰‹å‹•ã§ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚';
                            statusDiv.style.color = 'orange';
                            btn.disabled = false;
                            btn.textContent = 'ğŸ“ ç¾åœ¨åœ°å–å¾—';
                            return;
                        }
                        
                        const data = await response.json();
                        
                        // ä½æ‰€æƒ…å ±ã‚’æŠ½å‡ºï¼ˆçœŒãƒ»å¸‚ãƒ»ç”ºã¾ã§ï¼‰
                        const address = data.address;
                        let formattedAddress = '';
                        
                        // éƒ½é“åºœçœŒ
                        if (address.state) {
                            formattedAddress += address.state;
                        } else if (address.province) {
                            formattedAddress += address.province;
                        }
                        
                        // å¸‚åŒºç”ºæ‘
                        if (address.city) {
                            formattedAddress += address.city;
                        } else if (address.town) {
                            formattedAddress += address.town;
                        } else if (address.village) {
                            formattedAddress += address.village;
                        } else if (address.county) {
                            formattedAddress += address.county;
                        }
                        
                        // ç”ºåŸŸ
                        if (address.suburb) {
                            formattedAddress += address.suburb;
                        } else if (address.neighbourhood) {
                            formattedAddress += address.neighbourhood;
                        }
                        
                        if (formattedAddress) {
                            addressInput.value = formattedAddress;
                            statusDiv.textContent = 'âœ“ ä½æ‰€ã‚’å–å¾—ã—ã¾ã—ãŸ';
                            statusDiv.style.color = 'green';
                        } else {
                            statusDiv.textContent = 'ä½æ‰€æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                            statusDiv.style.color = 'orange';
                        }
                        
                    } catch (error) {
                        console.error('Geocoding error:', error);
                        statusDiv.textContent = 'ä½æ‰€ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                        statusDiv.style.color = 'orange';
                    }
                    
                    btn.disabled = false;
                    btn.textContent = 'ğŸ“ ç¾åœ¨åœ°å–å¾—';
                },
                function(error) {
                    let errorMsg = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = 'ä½ç½®æƒ…å ±ã®ä½¿ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = 'ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ';
                            break;
                        case error.TIMEOUT:
                            errorMsg = 'ä½ç½®æƒ…å ±ã®å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ';
                            break;
                        default:
                            errorMsg = 'ä½ç½®æƒ…å ±ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                    }
                    statusDiv.textContent = errorMsg + 'ã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                    statusDiv.style.color = 'orange';
                    btn.disabled = false;
                    btn.textContent = 'ğŸ“ ç¾åœ¨åœ°å–å¾—';
                }
            );
        });

        // åº—èˆ—ãƒ»ä¼šç¤¾æ¤œç´¢æ©Ÿèƒ½
        let storeSearchTimeout = null;
        let companySearchTimeout = null;
        let selectedStoreData = null;
        let selectedCompanyData = null;

        // OpenStreetMap Nominatim APIã‚’ä½¿ç”¨ã—ãŸæ¤œç´¢æ©Ÿèƒ½
        async function searchPlace(query, type) {
            if (!query || query.length < 2) {
                return [];
            }

            try {
                // æ—¥æœ¬å›½å†…ã«é™å®šã—ã¦æ¤œç´¢
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&countrycodes=jp&limit=10&accept-language=ja`,
                    {
                        method: 'GET',
                        headers: {
                            'User-Agent': 'StaffSearchApp/1.0',
                            'Accept': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    return [];
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Search error:', error);
                return [];
            }
        }

        // æ¤œç´¢çµæœã‚’è¡¨ç¤º
        function displaySearchResults(results, resultsDiv, inputField, onSelect) {
            resultsDiv.innerHTML = '';

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="search-no-results">æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
                resultsDiv.style.display = 'block';
                return;
            }

            results.forEach(result => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                
                const name = document.createElement('div');
                name.className = 'search-result-name';
                name.textContent = result.display_name.split(',')[0] || result.display_name;
                
                const address = document.createElement('div');
                address.className = 'search-result-address';
                address.textContent = result.display_name;
                
                item.appendChild(name);
                item.appendChild(address);
                
                item.addEventListener('click', function() {
                    inputField.value = result.display_name.split(',')[0] || result.display_name;
                    onSelect({
                        name: result.display_name.split(',')[0] || result.display_name,
                        address: result.display_name,
                        lat: result.lat,
                        lon: result.lon
                    });
                    resultsDiv.style.display = 'none';
                });
                
                resultsDiv.appendChild(item);
            });

            resultsDiv.style.display = 'block';
        }

        // åº—èˆ—æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('storeSearchBtn').addEventListener('click', async function() {
            const query = document.getElementById('storeName').value;
            const resultsDiv = document.getElementById('storeSearchResults');

            if (!query || query.length < 2) {
                alert('åº—èˆ—åã‚’2æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            resultsDiv.innerHTML = '<div class="search-loading">æ¤œç´¢ä¸­...</div>';
            resultsDiv.style.display = 'block';

            const results = await searchPlace(query, 'store');
            displaySearchResults(results, resultsDiv, document.getElementById('storeName'), function(data) {
                selectedStoreData = data;
                console.log('é¸æŠã•ã‚ŒãŸåº—èˆ—:', data);
            });
        });

        // ä¼šç¤¾æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('companySearchBtn').addEventListener('click', async function() {
            const query = document.getElementById('companyName').value;
            const resultsDiv = document.getElementById('companySearchResults');

            if (!query || query.length < 2) {
                alert('ä¼šç¤¾åã‚’2æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            resultsDiv.innerHTML = '<div class="search-loading">æ¤œç´¢ä¸­...</div>';
            resultsDiv.style.display = 'block';

            const results = await searchPlace(query, 'company');
            displaySearchResults(results, resultsDiv, document.getElementById('companyName'), function(data) {
                selectedCompanyData = data;
                console.log('é¸æŠã•ã‚ŒãŸä¼šç¤¾:', data);
            });
        });

        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢
        document.getElementById('storeName').addEventListener('input', function() {
            const query = this.value;
            const resultsDiv = document.getElementById('storeSearchResults');

            if (storeSearchTimeout) {
                clearTimeout(storeSearchTimeout);
            }

            if (!query || query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }

            storeSearchTimeout = setTimeout(async function() {
                resultsDiv.innerHTML = '<div class="search-loading">æ¤œç´¢ä¸­...</div>';
                resultsDiv.style.display = 'block';

                const results = await searchPlace(query, 'store');
                displaySearchResults(results, resultsDiv, document.getElementById('storeName'), function(data) {
                    selectedStoreData = data;
                    console.log('é¸æŠã•ã‚ŒãŸåº—èˆ—:', data);
                });
            }, 500);
        });

        document.getElementById('companyName').addEventListener('input', function() {
            const query = this.value;
            const resultsDiv = document.getElementById('companySearchResults');

            if (companySearchTimeout) {
                clearTimeout(companySearchTimeout);
            }

            if (!query || query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }

            companySearchTimeout = setTimeout(async function() {
                resultsDiv.innerHTML = '<div class="search-loading">æ¤œç´¢ä¸­...</div>';
                resultsDiv.style.display = 'block';

                const results = await searchPlace(query, 'company');
                displaySearchResults(results, resultsDiv, document.getElementById('companyName'), function(data) {
                    selectedCompanyData = data;
                    console.log('é¸æŠã•ã‚ŒãŸä¼šç¤¾:', data);
                });
            }, 500);
        });

        // æ¤œç´¢çµæœå¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#storeName') && !e.target.closest('#storeSearchResults') && !e.target.closest('#storeSearchBtn')) {
                document.getElementById('storeSearchResults').style.display = 'none';
            }
            if (!e.target.closest('#companyName') && !e.target.closest('#companySearchResults') && !e.target.closest('#companySearchBtn')) {
                document.getElementById('companySearchResults').style.display = 'none';
            }
        });

        // æ–°è¦åº—èˆ—ãƒ»ä¼šç¤¾ç™»éŒ²ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å‡¦ç†
        document.getElementById('newStoreCheck').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('storeName').placeholder = 'æ–°è¦åº—èˆ—åã‚’å…¥åŠ›';
                document.getElementById('storeSearchBtn').disabled = true;
                document.getElementById('storeSearchResults').style.display = 'none';
                selectedStoreData = null;
            } else {
                document.getElementById('storeName').placeholder = 'åº—èˆ—åã‚’æ¤œç´¢ã¾ãŸã¯å…¥åŠ›';
                document.getElementById('storeSearchBtn').disabled = false;
            }
        });

        document.getElementById('newCompanyCheck').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('companyName').placeholder = 'æ–°è¦ä¼šç¤¾åã‚’å…¥åŠ›';
                document.getElementById('companySearchBtn').disabled = true;
                document.getElementById('companySearchResults').style.display = 'none';
                selectedCompanyData = null;
            } else {
                document.getElementById('companyName').placeholder = 'ä¼šç¤¾åã‚’æ¤œç´¢ã¾ãŸã¯å…¥åŠ›';
                document.getElementById('companySearchBtn').disabled = false;
            }
        });

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        document.getElementById('staffRegisterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const storeName = document.getElementById('storeName').value;
            const companyName = document.getElementById('companyName').value;
            const age = document.getElementById('age').value;
            const address = document.getElementById('address').value;
            const gender = document.getElementById('gender').value;
            const jobTitleSelect = document.getElementById('jobTitle').value;
            const customJobTitle = document.getElementById('customJobTitle').value;
            const experience = document.getElementById('experience').value;
            const bio = document.getElementById('bio').value;
            const email = document.getElementById('email').value;
            const hasPhoto = document.getElementById('photoUpload').files.length > 0;

            // è·ç¨®ã‚’æ±ºå®šï¼ˆãã®ä»–ã®å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’ä½¿ç”¨ï¼‰
            let finalJobTitle = '';
            if (jobTitleSelect === 'other' && customJobTitle) {
                finalJobTitle = customJobTitle;
            } else {
                // è·ç¨®ã‚³ãƒ¼ãƒ‰ã‚’æ—¥æœ¬èªã«å¤‰æ›
                const jobTitleMap = {
                    'beautician': 'ç¾å®¹å¸«',
                    'consultant': 'ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ',
                    'trainer': 'ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼',
                    'lawyer': 'å¼è­·å£«ãƒ»å£«æ¥­',
                    'designer': 'ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼',
                    'engineer': 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢',
                    'teacher': 'è¬›å¸«ãƒ»æ•™å¸«',
                    'medical': 'åŒ»ç™‚å¾“äº‹è€…'
                };
                finalJobTitle = jobTitleMap[jobTitleSelect] || jobTitleSelect;
            }

            // ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const staffData = {
                name: name,
                storeName: storeName,
                companyName: companyName,
                age: age,
                location: address,
                address: address,
                gender: gender,
                jobTitle: finalJobTitle,
                experience: experience,
                bio: bio,
                email: email,
                hasPhoto: uploadedPhotos.length > 0,
                profileImages: uploadedPhotos.map(photo => ({
                    name: photo.name,
                    data: photo.data
                })),
                registeredAt: new Date().toISOString(),
                plan: 'free' // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³
            };
            
            localStorage.setItem('staff_profile', JSON.stringify(staffData));
            localStorage.setItem('staff_logged_in', 'true');
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒªç”¨ã®ã‚¹ã‚¿ãƒƒãƒ•ãƒªã‚¹ãƒˆã«è¿½åŠ 
            let staffList = [];
            try {
                const existingList = localStorage.getItem('all_staff_list');
                if (existingList) {
                    staffList = JSON.parse(existingList);
                }
            } catch (e) {
                console.error('æ—¢å­˜ã‚¹ã‚¿ãƒƒãƒ•ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
            
            // æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰
            const staffId = 'staff_' + Date.now();
            const existingIndex = staffList.findIndex(s => s.email === email);
            
            const staffListItem = {
                id: staffId,
                name: name,
                storeName: storeName,
                companyName: companyName,
                jobTitle: finalJobTitle,
                category: finalJobTitle,
                rating: 5.0,
                reviews: 0,
                hourlyRate: 5000,
                experience: experience + 'å¹´',
                bio: bio,
                location: address,
                distance: '0.0km',
                imageUrl: uploadedPhotos.length > 0 ? uploadedPhotos[0].data : 'https://via.placeholder.com/150',
                isOnline: false,
                tags: [finalJobTitle],
                email: email,
                registeredAt: new Date().toISOString()
            };
            
            if (existingIndex >= 0) {
                // æ—¢å­˜ã®ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ›´æ–°
                staffList[existingIndex] = staffListItem;
            } else {
                // æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ 
                staffList.unshift(staffListItem);
            }
            
            localStorage.setItem('all_staff_list', JSON.stringify(staffList));
            
            // ç™»éŒ²æˆåŠŸï¼ˆãƒ‡ãƒ¢ï¼‰
            const photoCount = uploadedPhotos.length;
            const photoMsg = photoCount > 0 ? `\nå†™çœŸ: ${photoCount}æšç™»éŒ²æ¸ˆã¿` : '';
            alert(`ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²å®Œäº†ï¼\nã‚ˆã†ã“ã ${name} ã•ã‚“${photoMsg}\n\nãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å……å®Ÿã•ã›ã¦ã€å¤šãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦‹ã¤ã‘ã¦ã‚‚ã‚‰ã„ã¾ã—ã‚‡ã†ï¼`);
            
            // ã‚¹ã‚¿ãƒƒãƒ•ã‚¢ãƒ—ãƒªã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            window.location.href = 'https://5061-ivmmk44rjvkdnze0ep01h-5185f4aa.sandbox.novita.ai/';
        });
    </script>
</body>
</html>
